(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[988],{7159:function(e,a,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/agendar",function(){return s(2519)}])},2519:function(e,a,s){"use strict";s.r(a),s.d(a,{default:function(){return Agendar}});var l=s(5893),n=s(7294),t=s(7185),o=s(3120),r=s(6398),i=s(8717),c=s(8281),d=s(2797);function LoadingSpinner(e){let{size:a="md",text:s="Carregando..."}=e;return(0,l.jsxs)("div",{className:"flex flex-col items-center justify-center gap-2",children:[(0,l.jsx)("div",{className:"".concat({sm:"w-4 h-4",md:"w-8 h-8",lg:"w-12 h-12"}[a]," border-4 border-gray-200 border-t-blue-600 rounded-full animate-spin")}),s&&(0,l.jsx)("p",{className:"text-gray-600",children:s})]})}function LoadingOverlay(e){let{isVisible:a=!1,text:s="Processando..."}=e;return a?(0,l.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:(0,l.jsx)("div",{className:"bg-white rounded-lg p-8 shadow-xl",children:(0,l.jsx)(LoadingSpinner,{size:"lg",text:s})})}):null}var x=s(3454);function Agendar(){let[e,a]=(0,n.useState)(1),[s,m]=(0,n.useState)(null),[u,b]=(0,n.useState)([]),[g,h]=(0,n.useState)(""),[p,f]=(0,n.useState)(""),[j,v]=(0,n.useState)([]),[N,y]=(0,n.useState)(null),[w,S]=(0,n.useState)(""),[C,k]=(0,n.useState)(!1),{addToast:P}=(0,d.p)(),handleSubmit=async()=>{try{if(!s){P("Por favor, selecione uma data","warning");return}if(!u.length){P("Por favor, selecione pelo menos um servi\xe7o","warning");return}if(!g){P("Por favor, insira o endere\xe7o","warning");return}k(!0),P("Processando agendamento...","info",0);let e={date:s,services:u,address:g,cep:p,photos:j,location:N,notes:w,totalPrice:calculateTotal()},l=x.env.NEXT_PUBLIC_API_URL||"http://localhost:3001",n=await fetch("".concat(l,"/api/bookings"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(localStorage.getItem("token")||"")},body:JSON.stringify(e),credentials:"include"});if(!n.ok){let e=await n.json();throw Error(e.message||"Falha ao agendar")}await n.json(),P("✅ Agendamento realizado com sucesso!","success"),a(1),m(null),b([]),h(""),f(""),v([]),y(null),S("")}catch(e){console.error("Erro ao processar agendamento:",e),P("Erro: ".concat(e.message||"Falha ao agendar. Tente novamente."),"error")}finally{k(!1)}},calculateTotal=()=>u.reduce((e,a)=>e+a.price,0);return(0,l.jsxs)("div",{className:"flex flex-col min-h-screen",children:[(0,l.jsx)(t.Z,{}),(0,l.jsxs)("main",{className:"flex-grow max-w-4xl mx-auto w-full px-4 py-8",children:[(0,l.jsx)("h1",{className:"text-3xl font-bold mb-8",children:"Agendar Servi\xe7o de Limpeza"}),(0,l.jsxs)("div",{className:"mb-8",children:[(0,l.jsx)("div",{className:"flex justify-between items-center mb-4",children:[1,2,3,4].map(a=>(0,l.jsx)("div",{className:"flex-1 h-2 mx-1 rounded transition ".concat(a<=e?"bg-blue-600":"bg-gray-300")},a))}),(0,l.jsxs)("p",{className:"text-center text-gray-600 font-semibold",children:["Passo ",e," de 4"]})]}),(0,l.jsxs)("div",{className:"bg-white rounded-lg shadow-lg p-8 mb-8",children:[1===e&&(0,l.jsx)(r.Z,{onDateSelected:m}),2===e&&(0,l.jsx)(i.Z,{onServiceSelected:b}),3===e&&(0,l.jsxs)("div",{children:[(0,l.jsx)("h3",{className:"text-xl font-bold mb-6",children:"Localiza\xe7\xe3o e Detalhes"}),(0,l.jsxs)("div",{className:"space-y-6",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block font-semibold mb-2",children:"Endere\xe7o Completo"}),(0,l.jsx)("input",{type:"text",value:g,onChange:e=>h(e.target.value),placeholder:"Rua, n\xfamero, complemento, bairro, cidade",className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-600"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block font-semibold mb-2",children:"CEP"}),(0,l.jsx)("input",{type:"text",value:p,onChange:e=>f(e.target.value),placeholder:"00000-000",className:"w-48 px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-600"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block font-semibold mb-2",children:"Fotos (no momento do agendamento)"}),(0,l.jsx)("input",{type:"file",accept:"image/*",multiple:!0,onChange:e=>v(Array.from(e.target.files)),className:"w-full"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block font-semibold mb-2",children:"Localiza\xe7\xe3o em tempo real"}),(0,l.jsxs)("div",{className:"flex gap-2 items-center",children:[(0,l.jsx)("button",{onClick:async()=>{if(!navigator.geolocation)return alert("Geolocaliza\xe7\xe3o n\xe3o suportada");navigator.geolocation.getCurrentPosition(e=>{let a={lat:e.coords.latitude,lng:e.coords.longitude};y(a)},e=>{alert("N\xe3o foi poss\xedvel obter localiza\xe7\xe3o: "+e.message)},{enableHighAccuracy:!0})},type:"button",className:"px-4 py-2 bg-blue-600 text-white rounded-lg",children:"Capturar localiza\xe7\xe3o atual"}),(0,l.jsx)("span",{className:"text-sm text-gray-600",children:N?"Lat ".concat(N.lat.toFixed(5),", Lng ").concat(N.lng.toFixed(5)):"Nenhuma localiza\xe7\xe3o capturada"})]})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block font-semibold mb-2",children:"Observa\xe7\xf5es Especiais"}),(0,l.jsx)("textarea",{value:w,onChange:e=>S(e.target.value),placeholder:"Ex: Apartamento com vidros especiais, animais de estima\xe7\xe3o...",className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-600",rows:"4"})]})]})]}),4===e&&(0,l.jsxs)("div",{children:[(0,l.jsx)("h3",{className:"text-xl font-bold mb-6",children:"Resumo do Agendamento"}),(0,l.jsxs)("div",{className:"space-y-4 bg-gray-50 p-6 rounded-lg",children:[(0,l.jsxs)("div",{className:"border-b pb-4",children:[(0,l.jsx)("p",{className:"font-semibold text-gray-600",children:"Data"}),(0,l.jsx)("p",{className:"text-lg font-bold",children:null==s?void 0:s.toLocaleDateString("pt-BR")})]}),(0,l.jsxs)("div",{className:"border-b pb-4",children:[(0,l.jsx)("p",{className:"font-semibold text-gray-600",children:"Servi\xe7os"}),u.map(e=>(0,l.jsxs)("p",{className:"text-lg",children:["✓ ",e.name]},e.id))]}),(0,l.jsxs)("div",{className:"border-b pb-4",children:[(0,l.jsx)("p",{className:"font-semibold text-gray-600",children:"Endere\xe7o"}),(0,l.jsx)("p",{className:"text-lg",children:g})]}),(0,l.jsxs)("div",{className:"border-b pb-4",children:[(0,l.jsx)("p",{className:"font-semibold text-gray-600",children:"Observa\xe7\xf5es"}),(0,l.jsx)("p",{className:"text-lg",children:w||"Nenhuma"})]}),(0,l.jsx)("div",{className:"pt-4",children:(0,l.jsx)(c.Z,{services:u,date:s})})]})]})]}),(0,l.jsxs)("div",{className:"flex gap-4 justify-between",children:[(0,l.jsx)("button",{onClick:()=>{e>1&&a(e-1)},disabled:1===e,className:"px-6 py-3 bg-gray-300 text-gray-700 rounded-lg font-bold disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-400 transition",children:"← Anterior"}),e<4?(0,l.jsx)("button",{onClick:()=>{e<4&&a(e+1)},className:"px-6 py-3 bg-blue-600 text-white rounded-lg font-bold hover:bg-blue-700 transition",children:"Pr\xf3ximo →"}):(0,l.jsx)("button",{onClick:handleSubmit,className:"px-8 py-3 bg-green-600 text-white rounded-lg font-bold hover:bg-green-700 transition text-lg",children:"✓ Confirmar Agendamento"})]})]}),(0,l.jsx)(LoadingOverlay,{isVisible:C,text:"Processando seu agendamento..."}),(0,l.jsx)(o.Z,{})]})}}},function(e){e.O(0,[664,874,774,888,179],function(){return e(e.s=7159)}),_N_E=e.O()}]);